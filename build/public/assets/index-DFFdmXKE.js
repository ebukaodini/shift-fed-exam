import{r as l,m as f,j as e,$ as g}from"./app-CcI4rQ-v.js";function w({content:s}){const[t,n]=l.useState(!1),[r,a]=l.useState(!1),x=l.useRef(null);l.useLayoutEffect(()=>{function d(){const c=x.current;if(c){const u=parseFloat(getComputedStyle(c).lineHeight)*3;a(c.scrollHeight>u+1)}}return d(),window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[s]);const m=()=>n(d=>!d);return e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{ref:x,className:`text-sand-11 text-base transition-all ${t?"":"line-clamp-3"}`,children:s}),r&&e.jsx("button",{onClick:m,className:"text-sm text-blue-600",children:t?"See less":"See more"})]})}function y({labels:s}){return e.jsx(e.Fragment,{children:s.length>0&&e.jsx("div",{className:"w-full sm:w-fit overflow-auto flex space-x-2",children:s.map(t=>e.jsx("div",{className:"border border-blue-200 rounded-md bg-blue-100 text-sand-11 text-xs px-2 py-1 font-medium whitespace-nowrap",children:t},t))})})}function N({tickets:s,hiddenTickets:t,onHide:n}){const r=s.filter(a=>!t.includes(a.id));return e.jsx("ul",{className:"space-y-4",children:r.length>0?r.map(a=>e.jsxs("li",{className:"bg-white border border-sand-7 rounded-lg p-6 hover:border-sand-8 hover:shadow-sm transition duration-200 relative group",children:[e.jsx("button",{className:"absolute top-2 right-3 text-sm text-sand-11 hover:text-sand-12 hidden group-hover:block",onClick:()=>n(a.id),children:"Hide"}),e.jsx("h5",{className:"text-lg font-semibold text-sand-12 mb-2",children:a.title}),e.jsx(w,{content:a.content}),e.jsxs("footer",{className:"w-full flex flex-col sm:flex-row gap-y-2 sm:gap-0 justify-start items-start sm:justify-between sm:items-center",children:[e.jsxs("div",{className:"text-sm text-sand-10",children:["By ",a.userEmail," | ",C(a.creationTime)]}),e.jsx(y,{labels:a.labels})]})]},a.id)):e.jsx(p,{hasHiddenTickets:t.length>0})})}function p({hasSearch:s,hasHiddenTickets:t}){return e.jsx("div",{className:"text-center py-12",children:e.jsx("div",{className:"text-lg text-sand-11",children:s?"No issues found matching your search.":t?"All issues are hidden.":"No security issues found."})})}function v({currentPage:s,lastPage:t,onPageChange:n}){return e.jsxs("div",{className:"flex justify-between items-center sm:justify-center sm:items-center gap-4 mt-8",children:[e.jsx("button",{disabled:s<=1,onClick:()=>n(s-1),className:"px-3 py-1 text-sm bg-sand-3 hover:bg-sand-4 text-sand-12 rounded-md disabled:opacity-50",children:"Previous"}),e.jsxs("span",{className:"text-sand-11 text-sm",children:["Page ",s," of ",t]}),e.jsx("button",{disabled:s>=t,onClick:()=>n(s+1),className:"px-3 py-1 text-sm bg-sand-3 hover:bg-sand-4 text-sand-12 rounded-md disabled:opacity-50",children:"Next"})]})}function S({search:s,handleSearch:t}){const[n,r]=l.useState(!1);return e.jsxs("div",{className:"relative flex flex-col",onBlur:()=>r(!1),children:[e.jsx("input",{type:"search",placeholder:"Search issues...",className:"w-full max-w-md px-4 py-2 border border-sand-7 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",onChange:a=>t(a.target.value),onFocus:()=>r(!0),value:s}),n&&e.jsxs("div",{className:"absolute top-full mt-0.5 px-4 py-2 flex flex-col gap-1 text-xs text-sand-9 w-full max-w-md z-20 bg-white rounded-lg ring-2 ring-primary",children:[e.jsx("span",{children:"Search Filters:"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-start sm:justify-between sm:items-center",children:[e.jsx("code",{className:"w-fit border border-blue-200 rounded-sm bg-blue-100 text-sand-11 text-xs",children:"after:27/09/2019 xss"}),e.jsx("span",{children:"Issues created after date"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-start sm:justify-between sm:items-center",children:[e.jsx("code",{className:"w-fit border border-blue-200 rounded-sm bg-blue-100 text-sand-11 text-xs",children:"before:27/09/2019 xss"}),e.jsx("span",{children:"Issues created before date"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-start sm:justify-between sm:items-center",children:[e.jsx("code",{className:"w-fit border border-blue-200 rounded-sm bg-blue-100 text-sand-11 text-xs",children:"reporter:sec@test.com xss"}),e.jsx("span",{children:"Issues created by reporter"})]})]})]})}function T({tickets:s}){const[t,n]=l.useState(""),[r,a]=l.useState([]),x=l.useCallback(i=>{a(o=>[...o,i])},[]),m=l.useCallback(()=>{a([])},[]);l.useEffect(()=>{m()},[t]),l.useLayoutEffect(()=>{const i=new URLSearchParams(window.location.search).get("search")||"";n(i.trim())},[]);const d=l.useCallback(function(o){n(o),f.get("/",o?{search:o.trim()}:{},{preserveState:!0,replace:!0})},[]),c=i=>{f.get("/",{...t&&{search:t.trim()},page:i},{preserveState:!0,replace:!0})},h=()=>{const i=new URLSearchParams;t&&i.append("search",t),r&&i.append("hidden",r.join(",")),window.open(`/tickets/export/csv?${i.toString()}`,"_blank")},u=(s==null?void 0:s.data)||[],b=E(s.meta),j=`${r.length} hidden ${r.length>1?"tickets":"ticket"} - `;return e.jsxs(e.Fragment,{children:[e.jsx(g,{title:"Security Issues"}),e.jsx("div",{className:"min-h-screen bg-sand-1",children:e.jsx("div",{className:"max-w-6xl mx-auto px-6 py-8",children:e.jsxs("main",{children:[e.jsx("h1",{className:"text-3xl font-bold text-sand-12 mb-8",children:"Security Issues List"}),e.jsx("header",{className:"mb-6 space-y-2",children:e.jsx(S,{search:t,handleSearch:d})}),s&&e.jsxs("div",{className:"mb-4 w-full flex flex-col sm:flex-row justify-start items-start sm:justify-between sm:items-center space-y-2",children:[e.jsxs("div",{className:"text-sm text-sand-11",children:[b,r.length>0&&e.jsxs("span",{className:"ml-1 italic",children:["(",j,e.jsx("button",{onClick:m,className:"italic !text-blue-600",children:"restore"}),")"]})]}),e.jsx("button",{disabled:s.meta.total==0,onClick:()=>h(),className:"px-3 py-1 text-sm bg-sand-3 hover:bg-sand-4 text-sand-12 rounded-md disabled:opacity-50",children:"Export CSV"})]}),u.length>0?e.jsxs("div",{className:"space-y-6",children:[e.jsx(N,{tickets:u,onHide:x,hiddenTickets:r}),s.meta.total>s.meta.perPage&&e.jsx(v,{currentPage:s.meta.currentPage,lastPage:s.meta.lastPage,onPageChange:c})]}):e.jsx(p,{hasSearch:!!t})]})})})]})}function C(s){return new Date(s).toISOString().replace("T"," ").replace(/\.\d{3}Z$/,"")}function E({currentPage:s,perPage:t,total:n}){const r=(s-1)*t+1,a=Math.min(s*t,n);return n<20?`Showing ${n} ${n>1?"issues":"issue"}`:`Showing ${r} - ${a} of ${n} issues`}export{T as default};
